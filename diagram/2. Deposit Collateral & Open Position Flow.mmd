sequenceDiagram
    participant User
    participant Frontend
    participant Vault Program
    participant Oracle
    participant Position Program
    participant Token Program
    
    User->>Frontend: Connect Phantom Wallet
    Frontend->>User: Show Markets (SOL², BTC², ETH²)
    
    User->>Frontend: Select SOL², Enter 10 SOL
    Frontend->>Vault Program: deposit_collateral(10 SOL)
    
    Vault Program->>Vault Program: Create User Vault PDA
    Note over Vault Program: PDA: ["vault", user_pubkey]
    
    Vault Program->>Vault Program: Transfer SOL to Vault
    Vault Program->>Frontend: ✅ Deposit Confirmed
    
    Frontend->>User: Show: "10 SOL deposited"
    
    User->>Frontend: Mint 2 SOL² tokens
    Frontend->>Oracle: Fetch SOL Price
    Oracle-->>Frontend: Price: $100
    
    Frontend->>Position Program: open_long_position(2)
    
    Position Program->>Oracle: Verify Current Price
    Oracle-->>Position Program: $100 (Index²: $10,000)
    
    Position Program->>Position Program: Check Collateral Ratio
    Note over Position Program: (10 SOL × $100) / (2 × $10,000) = 200% ✓
    
    Position Program->>Position Program: Create Position Account PDA
    Note over Position Program: PDA: ["position", user_pubkey, market]
    
    Position Program->>Vault Program: Lock 10 SOL Collateral
    Position Program->>Token Program: Mint 2 SOL² Tokens
    
    Token Program-->>User: Transfer 2 SOL² to User Wallet
    Position Program->>Frontend: ✅ Position Opened
    
    Frontend->>User: Show Position Dashboard<br/>2 SOL², Entry $10k, Collateral 10 SOL